---
title: "HW3"
author: "Akhil Repaka"
date: "`r Sys.Date()`"
output:
  pdf_document: default
  html_document: default
---

```{r setuo, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning=FALSE, message = FALSE)
gasprices <- read.csv('gasprices.csv')
cars <- read.csv('sclass.csv')
nbc <- read.csv('nbc_pilotsurvey.csv')
ebay <- read.csv('ebay.csv')
library(tidyverse)
library(mosaic)
library(ggplot2)
library(tidyr)
library(dplyr)
library(kableExtra)
```

```{r}

# problem 1a

# original analysis without accounting for sampling uncertainity
ggplot(gasprices, aes(y = Price, x = Competitors)) + geom_boxplot()
aggregate_comp <- aggregate(Price ~ Competitors, gasprices, mean) # shows the means of competitors in sight and lack of competitors without accounting for uncertainty
aggregate_comp <- kable(aggregate_comp)
aggregate_comp
```

```{r}
# bootstrapping
set.seed(123) #ensure same random sampling every time the code is ran
boot_comp = do(10000)*diffmean(Price ~ Competitors, data=mosaic::resample(gasprices)) #re-sampling the data set 10,000 times and synthetically providing randomization through bootstrapping

# confidence interval
comp_ci <- confint(boot_comp, level = 0.95) # creating the confidence interval
comp_ci <- kable(comp_ci)
comp_ci <- kable_styling(comp_ci, bootstrap_options = "striped", full_width = FALSE)
comp_ci

# visualization 
boot_comp_df <- as.data.frame(boot_comp)
boot_comp_df <- pivot_longer(boot_comp_df, cols = everything(), names_to = "Competitors", values_to = "Mean_Price") #converting object to data frame
ggplot(boot_comp_df, aes(x = Mean_Price)) + geom_histogram() #visualizing the 10,000 re-samples
```

Claim: Gas stations charge more if they lack direct competition in sight.

Evidence: Observing the original sample's average gas price between gas stations with competitors in sight vs. lack of competitors in sight differs by ~ 0.02$. This is a marginal difference that vaguely supports the idea that gas stations with a lack of competitors charge more for their gas prices. And even when accounting for sampling uncertainity, the difference in price between gas stations that have competitors in sight and those who don't is somewhere between -0.056 and 0.008, with 95% confidence. 

Conclusion: Since 0 is included in the 95% confidence interval, we can conclude that this evidence does not support the theory that gas stations charge more if they lack direct competition in sight 


```{r}

# problem 1b

ggplot(gasprices, aes(y = Price, x = Income)) + geom_point()

cor(gasprices$Price, gasprices$Income) 

set.seed(123)
boot_income = do(10000) * cor(Price ~ Income, data=mosaic::resample(gasprices)) 


income_ci <- confint(boot_income, level = 0.95) # creating the confidence interval
income_ci <- kable(income_ci)
income_ci <- kable_styling(income_ci, bootstrap_options = "striped", full_width = FALSE)
income_ci


```

Claim: The richer the area, the higher the gas prices.

Evidence: Observing the original sample's correlation coefficient between gas price and median income of the area, we can see there is a slight positive correlation between the two. This is a significant difference that supports the original claim. And even when accounting for sampling uncertainity, the difference in gas price between median areas of income is somewhere between 0.198 and 0.566, with 95% confidence.

Conclusion: Since 0 is not included in the 95% confidence interval and the estimate is only slightly lower than the original sample's correlation coefficient, we can safely conclude that this evidence supports the theory that gas stations charge more in richer areas. 


```{r}

# problem 1c

ggplot(gasprices, aes(y = Price, x = Stoplight)) + geom_boxplot()
c <- aggregate(Price ~ Stoplight, gasprices, mean) # shows the mean between competitors in sight and lack of competitors without accounting for uncertainty
c

set.seed(123)
boot_stoplight = do(10000)*diffmean(Price ~ Stoplight, data=mosaic::resample(gasprices)) #resampling the data set 10,000 times and synthetically providing randomization through bootstrapping

stoplight_ci <- confint(boot_stoplight, level = 0.95)
stoplight_ci <- kable(stoplight_ci)
stoplight_ci <- kable_styling(stoplight_ci, bootstrap_options = "striped", full_width = FALSE)
stoplight_ci

boot_stoplight_df <- as.data.frame(boot_stoplight)

boot_stoplight_df <- pivot_longer(boot_stoplight_df, cols = everything(), names_to = "Stoplight", values_to = "Mean_Price")

ggplot(boot_stoplight_df, aes(x = Mean_Price)) + geom_histogram()

```

Claim: Gas stations at stoplights charge more.

Evidence: Observing the original sample's average between the gas prices of gas stations at or not at a stoplight, we can see there is a marginal difference in their averages by ~0.03$. When accounting for sampling uncertainity, the difference in gas price between median areas of income is somewhere between -0.037 and 0.030, with 95% confidence.

Conclusion: Since 0 is included right in the middle of  the 95% confidence interval, we can safely conclude that this evidence does not support the theory that gas stations at stoplights charge more.
```{r}

# problem 1d

ggplot(gasprices, aes(y = Price, x = Highway)) + geom_boxplot()
c <- aggregate(Price ~ Highway, gasprices, mean)
c

set.seed(123)
boot_highway = do(10000)*diffmean(Price ~ Highway, data=mosaic::resample(gasprices)) 

highway_ci <- confint(boot_highway, level = 0.95)
highway_ci <- kable(highway_ci)
highway_ci <- kable_styling(highway_ci, bootstrap_options = "striped", full_width = FALSE)
highway_ci

boot_highway_df <- as.data.frame(boot_highway)

boot_highway_df <- pivot_longer(boot_highway, cols = everything(), names_to = "Highway", values_to = "Mean_Price")

ggplot(boot_highway_df, aes(x = Mean_Price)) + geom_histogram()

```
Claim: Gas stations with direct highway access charge more.

Evidence: Observing the original sample's average between the gas prices of gas stations with direct access to the highway versus those who don't, we can see there is a marginal difference in their averages by ~0.05$. When accounting for sampling uncertainity, the difference in gas price between median areas of income is somewhere between 0.008 and 0.081, with 95% confidence.

Conclusion: Since 0 is not included in the 95% confidence interval, we can conclude that this evidence does support the theory that gas stations with direct access to the highway charge more, even if just by a little. 

```{r}

# problem 1e

gasprices$is_shell <- ifelse(gasprices$Brand == "Shell", "Yes", "No") #creaing new boolean column that specifies whether the specific gas station is a Shell one or not

ggplot(gasprices, aes(y = Price, x = is_shell)) + geom_boxplot()
c <- aggregate(Price ~ is_shell, gasprices, mean)
c

set.seed(123)
boot_is_shell = do(10000)*diffmean(Price ~ is_shell, data=mosaic::resample(gasprices)) 

shell_ci <- confint(boot_is_shell, level = 0.95)
shell_ci <- kable(shell_ci)
shell_ci <- kable_styling(shell_ci, bootstrap_options = "striped", full_width = FALSE)
shell_ci

boot_is_shell_df <- as.data.frame(boot_is_shell)

boot_is_shell_df <- pivot_longer(boot_is_shell, cols = everything(), names_to = "Shell", values_to = "Mean_Price")

ggplot(boot_is_shell_df, aes(x = Mean_Price)) + geom_histogram()


```

Claim: Shell charges more than all other non-Shell brands.

Evidence: Observing the original sample's average between the gas prices Shell and non-Shell gas stations, we can see there is a marginal difference in their averages by ~0.03$. When accounting for sampling uncertainity, the difference in gas price between Shell and non-Shell gas stations is somewhere between -0.010 and 0.066, with 95% confidence.

Conclusion: Since 0 is included in the 95% confidence interval, we can conclude that this evidence does not support the theory that Shell gas stations charge more, however, some can argue since the upper limit is much higher than the lower, there is a significant difference and this evidence does in fact support the original claim. I do not agree with that though! 


```{r}
# Problem 2a


filtered_cars <- filter(cars, year == 2011 & trim == "63 AMG")

set.seed(123)
boot_mileage = do(10000)*mean(~mileage, data=mosaic::resample(filtered_cars)) 

boot_mile_ci <- confint(boot_mileage, level = 0.95)
boot_mile_ci <- kable(boot_mile_ci)
boot_mile_ci <- kable_styling(boot_mile_ci, bootstrap_options = "striped", full_width = FALSE)
boot_mile_ci

```
With a 95% confidence level, we can conclude the average mileage of 2011 S-Class 63 AMGs that were hitting the used-car market was between 26,322.1 and 31862.7 miles. 


```{r}
## Problem 2b

filtered_cars2 <- filter(cars, year == 2014 & trim == "550")

filtered_cars2 <- mutate(filtered_cars2, is_black = color=="Black")

set.seed(123)
boot_black = do(10000)*prop(~is_black, data=mosaic::resample(filtered_cars2)) 

boot_black_ci = confint(boot_black, level = 0.95)
boot_black_ci <- kable(boot_black_ci)
boot_black_ci <- kable_styling(boot_black_ci, bootstrap_options = "striped", full_width = FALSE)
boot_black_ci

```
With a 95% confidence level, we can conclude the proportion of all 2014 S-Class 550s that were painted black is between 41.7% and 45.3%.

Question 3a

Question: Is there evidence that either “Living with Ed” or “My Name is Earl.” consistently produces a higher mean Q1_Happy response among viewers?

Approach: To answer this question I found the difference of means between each show's Q1 happy rating. To account for uncertainity, I used bootstrapping and found the 95% confidence interval to determine the limits the average mean fell into. 

Results:
```{r}
# Problem 3a

filterednbc <- filter(nbc, Show == "Living with Ed" | Show == "My Name is Earl")

set.seed(123)
boot_happy <- do(10000) * diffmean(Q1_Happy ~ Show, data = resample(filterednbc))
happy_ci <- confint(boot_happy, level = 0.95)
happy_ci <- kable(happy_ci)
happy_ci <- kable_styling(happy_ci, bootstrap_options = "striped", full_width = FALSE)
happy_ci

```

We can see that the interval is between -0.398 and 0.099 indicating a high variety between all of the resamples. 


Conclusion: Solely based on the limits of the interval, it looks like the mean happiness score for "My Name is Earl" is higher than "Living with Ed". However since the interval contains the value 0, we can conclude the difference is not significant enough for us to safely assume one show, on average, provoked more happiness responses than the other. 


Question: Is there evidence that "The Apprentice: Los Angeles" or "The Biggest Loser" consistently produces a higher mean Q1_Annoyed response among viewers?

Approach: To answer this question I found the difference of means between each show's Q1 annoyed rating. To account for uncertainity, I used bootstrapping and found the 95% confidence interval to determine the limits the average mean fell into. 

Results:

```{r}

# Problem 3b

filterednbc2 <- filter(nbc, Show == "The Biggest Loser" | Show == "The Apprentice: Los Angeles")

set.seed(123)
boot_annoyed <- do(10000) * diffmean(Q1_Annoyed ~ Show, data = resample(filterednbc2))
confint(boot_annoyed, level = 0.95)

annoyed_ci<- confint(boot_annoyed, level = 0.95)
annoyed_ci <- kable(annoyed_ci)
annoyed_ci <- kable_styling(annoyed_ci, bootstrap_options = "striped", full_width = FALSE)
annoyed_ci


```
We can see that the interval is between -0.526 and 0.020.

Conclusion: Solely based on the limits of the interval, it looks like the mean annoyed score for "The Apprentice: Los Angeles" is higher than "The Biggest Loser". And since the interval is entirely negative and does not include 0, we can conclude the difference is significant enough for us to safely assume one show, on average, provoked more annoyed responses than the other. 


```{r}

# Problem 3c

filterednbc3 <- filter(nbc, Show == "Dancing with the Stars")

filterednbc3 <- mutate(filterednbc3, greater_4 = Q2_Confusing=="4" | Q2_Confusing =="5")

set.seed(123)
boot_confused = do(10000) * prop(~greater_4, data = resample(filterednbc3))
confint(boot_confused, level = 0.95)

confused_ci <- confint(boot_confused, level = 0.95)
confused_ci <- kable(confused_ci)
confused_ci <- kable_styling(confused_ci, bootstrap_options = "striped", full_width = FALSE)
confused_ci

```

```{r}

# 4a

ebay1 <- mutate(ebay, rev_ratio = rev_after/rev_before)

set.seed(123)
boot_ebay1 = do(10000) * diffmean(rev_ratio~adwords_pause, data = resample(ebay1))

confint(boot_ebay1, level = 0.95)

ebay_ci <- confint(boot_ebay1, level = 0.95)
ebay_ci <- kable(ebay_ci)
ebay_ci <- kable_styling(ebay_ci, bootstrap_options = "striped", full_width = FALSE)
ebay_ci

```